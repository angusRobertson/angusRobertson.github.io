<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Angus Robertson - Publications</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Angus Robertson</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./publications.html" aria-current="page"> 
<span class="menu-text">Publications</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section">2023</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2022</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">2021</a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3">2020</a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4">2019</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5">2018</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Publications</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">2023</h2>
<p>Yang Shen, Angus J. Robertson, Ad Bax. Validation of ensemble and static X-ray crystal structure representations of SARS-CoV2 main protease by solution NMR residual dipolar couplings. <em>Journal of Molecular Biology</em>. 435: 11, 168067, 2023. <a href="https://doi.org/10.1016/j.jmb.2023.168067">https://doi.org/10.1016/j.jmb.2023.168067</a>. Access the <a href="resources/papers/14.pdf">MS üìñ</a>, <a href="resources/papers/14_SI.pdf">SI üìñ</a>.</p>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">2022</h2>
<p>Angus J. Robertson, Jinfa Ying, Ad Bax. NMR Observation of Sylfhydryl Signals in SARS-CoV-2 Main Protease Aids Structural Studies. <em>ChemBioChem</em>. e202200471, 2022. <a href="https://doi.org/10.1002/cbic.202200471">https://doi.org/10.1002/cbic.202200471</a>. Access the <a href="resources/papers/13.pdf">MS üìñ</a>, <a href="resources/papers/13_SI.pdf">SI üìñ</a>.</p>
<p>Angus J. Robertson‚Ä†, F. Aaron Cruz-Navarrete‚Ä†, Henry P. Wood, Nikita Vekaria, Andrea M. Hounslow, Claudine Bisson, Matthew J. Cliff, Nicola J. Baxter, and Jonathan P. Waltho. An enzyme with high catalytic proficiency utilizes distal site substrate binding energy to stabilize the closed state but at the expense of substrate inhibition. <em>ACS catalysis</em>. 12(5):3149-3164, 2022. <a href="https://doi.org/10.1021/acscatal.1c05524">https://doi.org/10.1021/acscatal.1c05524</a>. Access the <a href="resources/papers/12.pdf">MS üìñ</a>, <a href="resources/papers/12_SI.pdf">SI üìñ</a>.</p>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2">2021</h2>
<p>Altincekic Nadide, Korn Sophie Marianne, Qureshi Nusrat Shahin, Dujardin Marie, Ninot-Pedrosa Mart√≠, Abele Rupert, Abi Saad Marie Jose, Alfano Caterina, Almeida Fabio C. L., Alshamleh Islam, de Amorim Gisele Cardoso, Anderson Thomas K., Anobom Cristiane D., Anorma Chelsea, Bains Jasleen Kaur, Bax Adriaan, Blackledge Martin, Blechar Julius, B√∂ckmann Anja, Brigandat Louis, Bula Anna, B√ºtikofer Matthias, Camacho-Zarco Aldo R., Carlomagno Teresa, Caruso Icaro Putinhon, Ceylan Bet√ºl, Chaikuad Apirat, Chu Feixia, Cole Laura, Crosby Marquise G., de Jesus Vanessa, Dhamotharan Karthikeyan, Felli Isabella C., Ferner Jan, Fleischmann Yanick, Fogeron Marie-Laure, Fourkiotis Nikolaos K., Fuks Christin, F√ºrtig Boris, Gallo Angelo, Gande Santosh L., Gerez Juan Atilio, Ghosh Dhiman, Gomes-Neto Francisco, Gorbatyuk Oksana, Guseva Serafima, Hacker Carolin, H√§fner Sabine, Hao Bing, Hargittay Bruno, Henzler-Wildman K., Hoch Jeffrey C., Hohmann Katharina F., Hutchison Marie T., Jaudzems Kristaps, Joviƒá Katarina, Kaderli Janina, Kalni≈Ü≈° Gints, Ka≈Üepe Iveta, Kirchdoerfer Robert N., Kirkpatrick John, Knapp Stefan, Krishnathas Robin, Kutz Felicitas, zur Lage Susanne, Lambertz Roderick, Lang Andras, Laurents Douglas, Lecoq Lauriane, Linhard Verena, L√∂hr Frank, Malki Anas, Bessa Luiza Mamigonian, Martin Rachel W., Matzel Tobias, Maurin Damien, McNutt Seth W., Mebus-Antunes Nathane Cunha, Meier Beat H., Meiser Nathalie, Mompe√°n Miguel, Monaca Elisa, Montserret Roland, Mari√±o Perez Laura, Moser Celine, Muhle-Goll Claudia, Neves-Martins Thais Cristtina, Ni Xiamonin, Norton-Baker Brenna, Pierattelli Roberta, Pontoriero Letizia, Pustovalova Yulia, Ohlenschl√§ger Oliver, Orts Julien, Da Poian Andrea T., Pyper Dennis J., Richter Christian, Riek Roland, Rienstra Chad M., Robertson Angus, Pinheiro Anderson S., Sabbatella Raffaele, Salvi Nicola, Saxena Krishna, Schulte Linda, Schiavina Marco, Schwalbe Harald, Silber Mara, Almeida Marcius da Silva, Sprague-Piercy Marc A., Spyroulias Georgios A., Sreeramulu Sridhar, Tants Jan-Niklas, TƒÅrs Kaspars, Torres Felix, T√∂ws Sabrina, Trevi√±o Miguel √Å., Trucks Sven, Tsika Aikaterini C., Varga Krisztina, Wang Ying, Weber Marco E., Weigand Julia E., Wiedemann Christoph, Wirmer-Bartoschek Julia, Wirtz Martin Maria Alexandra, Zehnder Johannes, Hengesbach Martin, Schlundt Andreas. Large-Scale Recombinant Production of the SARS-CoV-2 Proteome for High-Throughput and Structural Biology Applications. <em>Frontiers in Molecular Biosciences</em>, 2021 8:89. <a href="https://doi.org/10.3389/fmolb.2021.653148">https://doi.org/10.3389/fmolb.2021.653148</a>. Access the <a href="resources/papers/11.pdf">MS üìñ</a>, <a href="resources/papers/11_SI.pdf">SI üìñ</a>.</p>
<p>Sai Chaitanya Chiliveri, Angus J. Robertson, Yang Shen, Dennis A Torchia, and Ad Bax. Advances in NMR Spectroscopy of Weakly Aligned Biomolecular Systems. <em>Chemical Reviews</em>, 122, 10, 9307-9330, 2022. <a href="https://doi.org/10.1021/acs.chemrev.1c00730">https://doi.org/10.1021/acs.chemrev.1c00730</a>. Access the <a href="resources/papers/10.pdf">MS üìñ</a>, <a href="resources/papers/10_SI.pdf">SI üìñ</a>.</p>
<p>Angus J. Robertson‚Ä†, Joseph M. Courtney‚Ä†, Yang Shen, Jinfa Ying, and Ad Bax. Concordance of X-ray and AlphaFold2 Models of SARS-CoV-2 Main Protease with Residual Dipolar Couplings Measured in Solution. <em>Journal of the American Chemical Society</em>. 43(46):19306-19310, 2021. <a href="https://doi.org/10.1021/jacs.1c10588">https://doi.org/10.1021/jacs.1c10588</a>. Access the <a href="resources/papers/9.pdf">MS üìñ</a>, <a href="resources/papers/9_SI.pdf">SI üìñ</a>.</p>
<p>Angus J. Robertson‚Ä†, Alex L. Wilson‚Ä†, Matthew J. Burn, Matthew J. Cliff, Paul L. A. Popelier, and Jonathan P. Waltho. The Relationship between Enzyme Conformational Change, Proton Transfer, and Phosphoryl Transfer in beta-Phosphoglucomutase. <em>ACS Catalysis</em>, 7:12840‚Äì12849, 2021. <a href="https://doi.org/10.1021/acscatal.1c01389">https://doi.org/10.1021/acscatal.1c01389</a>. Access the <a href="resources/papers/8.pdf">MS üìñ</a>, <a href="resources/papers/8_SI.pdf">SI üìñ</a>.</p>
<p>Angus J. Robertson, Jinfa Ying, and Ad Bax. Four-dimensional NOE-NOE spectroscopy of SARS-CoV-2 Main Protease to facilitate resonance assignment and structural analysis. <em>Magnetic Resonance</em>, 2(1):129‚Äì138, 2021. <a href="https://doi.org/10.5194/mr-2-129-2021">https://doi.org/10.5194/mr-2-129-2021</a>. Access the <a href="resources/papers/7.pdf">MS üìñ</a>, <a href="resources/papers/7_SI.pdf">SI üìñ</a>.</p>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3">2020</h2>
<p>Henry. P. Wood, F. Arron. Cruz-Navarrete, Nicola. J. Baxter, Clare. R. Trevitt, Angus J. Robertson, Sam R. Dix, Andrea M. Hounslow, Matthew J. Cliff, and Jon P. Waltho. Allomorphy as a mechanism of post-translational control of enzyme activity. <em>Nature Communications</em>, 11(1):5538, 2020. <a href="https://doi.org/10.1038/s41467-020-19215-9">https://doi.org/10.1038/s41467-020-19215-9</a>. Access the <a href="resources/papers/6.pdf">MS üìñ</a>, <a href="resources/papers/6_SI.pdf">SI üìñ</a></p>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4">2019</h2>
<p>C. Ashley Barnes‚Ä†, Angus J. Robertson‚Ä†, John. M. Louis, Philip Anfinrud, and Ad Bax. Observation of beta-Amyloid Peptide Oligomerization by Pressure-Jump NMR Spectroscopy. <em>Journal of the American Chemical Society</em>, 141(35):13762‚Äì13766, 2019. <a href="https://doi.org/10.1021/jacs.9b06970">https://doi.org/10.1021/jacs.9b06970</a> Access the <a href="resources/papers/5.pdf">MS üìñ</a>, <a href="resources/papers/5_SI.pdf">SI üìñ</a></p>
<p>L. S. Gonzalez-Delgado, H. Walters-Morgan, B. Salamaga, A. J. Robertson, A. M. Hounslow, E. Jagielska, I. Sabala, M. P. Williamson, A. L. Lovering, and S. Mesnage. Two-site recognition of Staphylococcus aureus peptidoglycan by lysostaphin SH3b. <em>Nature Chemical Biology</em>, 16(1):24‚Äì30, 2020. <a href="https://doi.org/10.1038/s41589-019-0393-4">https://doi.org/10.1038/s41589-019-0393-4</a> Access the <a href="resources/papers/4.pdf">MS üìñ</a>, <a href="resources/papers/4_SI.pdf">SI üìñ</a></p>
<p>Nate B. P. Adams, Angus J. Robertson, C. Neil Hunter, Andrew Hitchcock, and Claudine Bisson. Phosphite binding by the HtxB periplasmic binding protein depends on the protonation state of the ligand. <em>Scientific Reports</em>, 9(1):10231, 2019. <a href="https://doi.org/10.1038/s41598-019-46557-2">https://doi.org/10.1038/s41598-019-46557-2</a> Access the <a href="resources/papers/3.pdf">MS üìñ</a>, <a href="resources/papers/3_SI.pdf">SI üìñ</a></p>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5">2018</h2>
<p>Angus J. Robertson‚Ä†, Luke A. Johnson‚Ä†, Nicola J. Baxter, Clare R. Trevitt, Claudine Bisson, Yi Jin, Henry P. Wood, Andrea M. Hounslow, Matthew J. Cliff, G. Michael Blackburn, Matthew W. Bowler, and Jonathan P. Waltho. Van der Waals Contact. between Nucleophile and Transferring Phosphorus Is Insufficient to Achieve Enzyme Transition-State Architecture. <em>ACS Catalysis</em>, 8(9):8140‚Äì8153, 2018. <a href="https://doi.org/10.1021/acscatal.8b01612">https://doi.org/10.1021/acscatal.8b01612</a>. Access the <a href="resources/papers/1.pdf">MS üìñ</a>, <a href="resources/papers/2_SI.pdf">SI üìñ</a>]</p>
<p>G. A. Sutherland, K. J. Grayson, N. B. P. Adams, D. M. J. Mermans, A. S. Jones, A. J. Robertson, D. B. Auman, A. A. Brindley, F. Sterpone, P. Tuffery, P. Derreumaux, P. L. Dutton, C. Robinson, A. Hitchcock, and C. N. Hunter. Probing the quality control mechanism of the Escherichia coli twin-arginine translocase with folding variants of a de novo-designed heme protein. <em>The Journal of Biological Chemistry</em>, 293(18):6672‚Äì6681, 2018. <a href="https://doi.org/10.1074/jbc.RA117.000880">https://doi.org/10.1074/jbc.RA117.000880</a>. Access the <a href="resources/papers/1.pdf">MS üìñ</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>